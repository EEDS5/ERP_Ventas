<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports
        http://jasperreports.sourceforge.net/xsd/jasperreport.xsd"
    name="ReporteVentasPorCliente"
    pageWidth="595" pageHeight="842"
    columnWidth="515" leftMargin="40" rightMargin="40" topMargin="50" bottomMargin="50">

  <!-- Parámetro para el título -->
  <parameter name="ReportTitle" class="java.lang.String"/>
  
  <!-- Campos -->
  <field name="clienteId"      class="java.lang.Integer"/>
  <field name="clienteNombre"  class="java.lang.String"/>
  <field name="ventaId"        class="java.lang.Integer"/>
  <field name="fechaVenta"     class="java.util.Date"/>
  <field name="totalVenta"     class="java.math.BigDecimal"/>

  <!-- Variable para sumar totales -->
  <variable name="TotalGeneral" class="java.math.BigDecimal" calculation="Sum">
    <variableExpression><![CDATA[$F{totalVenta}]]></variableExpression>
  </variable>

  <!-- Estilos -->
  <style name="Title" fontSize="18" isBold="true"/>
  <style name="ColumnHead" backcolor="#F1F1F1" mode="Opaque" isBold="true"/>

  <!-- Título -->
  <title>
    <band height="50">
      <textField>
        <reportElement x="0" y="0" width="515" height="30"/>
        <textElement textAlignment="Center" verticalAlignment="Middle">
          <styleReference name="Title"/>
        </textElement>
        <textFieldExpression><![CDATA[$P{ReportTitle}]]></textFieldExpression>
      </textField>
    </band>
  </title>

  <!-- Encabezados de columna -->
  <columnHeader>
    <band height="20">
      <staticText>
        <reportElement x="0" y="0" width="50" height="20"/>
        <textElement><styleReference name="ColumnHead"/></textElement>
        <text><![CDATA[#]]></text>
      </staticText>
      <staticText>
        <reportElement x="50" y="0" width="150" height="20"/>
        <textElement><styleReference name="ColumnHead"/></textElement>
        <text><![CDATA[Cliente]]></text>
      </staticText>
      <staticText>
        <reportElement x="200" y="0" width="80" height="20"/>
        <textElement><styleReference name="ColumnHead"/></textElement>
        <text><![CDATA[Venta ID]]></text>
      </staticText>
      <staticText>
        <reportElement x="280" y="0" width="120" height="20"/>
        <textElement><styleReference name="ColumnHead"/></textElement>
        <text><![CDATA[Fecha Venta]]></text>
      </staticText>
      <staticText>
        <reportElement x="400" y="0" width="115" height="20"/>
        <textElement><styleReference name="ColumnHead"/></textElement>
        <text><![CDATA[Total (Bs)]]></text>
      </staticText>
    </band>
  </columnHeader>

  <!-- Detalle -->
  <detail>
    <band height="20">
      <textField>
        <reportElement x="0" y="0" width="50" height="20"/>
        <textFieldExpression><![CDATA[$V{REPORT_COUNT}]]></textFieldExpression>
      </textField>
      <textField>
        <reportElement x="50" y="0" width="150" height="20"/>
        <textFieldExpression><![CDATA[$F{clienteNombre}]]></textFieldExpression>
      </textField>
      <textField>
        <reportElement x="200" y="0" width="80" height="20"/>
        <textFieldExpression><![CDATA[$F{ventaId}]]></textFieldExpression>
      </textField>
      <textField pattern="yyyy-MM-dd HH:mm">
        <reportElement x="280" y="0" width="120" height="20"/>
        <textFieldExpression><![CDATA[$F{fechaVenta}]]></textFieldExpression>
      </textField>
      <textField pattern="#,##0.00">
        <reportElement x="400" y="0" width="115" height="20"/>
        <textFieldExpression><![CDATA[$F{totalVenta}]]></textFieldExpression>
      </textField>
    </band>
  </detail>

  <!-- Pie de página con número de página -->
  <pageFooter>
    <band height="20">
      <textField evaluationTime="Report">
        <reportElement x="0" y="0" width="515" height="20"/>
        <textElement textAlignment="Right"/>
        <textFieldExpression><![CDATA["Página " + $V{PAGE_NUMBER} + " de " + $V{MASTER_TOTAL_PAGES}]]></textFieldExpression>
      </textField>
    </band>
  </pageFooter>

  <!-- Sumario con total general -->
  <summary>
    <band height="30">
      <staticText>
        <reportElement x="300" y="0" width="150" height="20"/>
        <textElement textAlignment="Right" isBold="true"/>
        <text><![CDATA[Total General:]]></text>
      </staticText>
      <textField pattern="#,##0.00">
        <reportElement x="450" y="0" width="65" height="20"/>
        <textFieldExpression><![CDATA[$V{TotalGeneral}]]></textFieldExpression>
      </textField>
    </band>
  </summary>

</jasperReport>