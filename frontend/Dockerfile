# Dockerfile optimizado para Angular Frontend

# Etapa 1: Build de la aplicaci칩n o entorno de desarrollo
FROM node:20 AS build

WORKDIR /app

# Copiar package.json y package-lock.json
COPY package*.json ./

# Usar npm ci para instalaci칩n m치s limpia y r치pida
RUN npm ci

# Copiar todo el c칩digo fuente
COPY . .

# 拘勇 BLOQUE TEMPORAL PARA NG SERVE (MODO DESARROLLO)
# Este bloque reemplaza el build de producci칩n y Nginx solo mientras depuras

# Instalar Angular CLI globalmente (si no est치 en devDependencies)
RUN npm install -g @angular/cli

# Exponer el puerto 4200 para servir en modo dev
EXPOSE 4200

# Ejecutar Angular en modo desarrollo con proxy
CMD ["ng", "serve", "--host", "0.0.0.0", "--port", "4200", "--disable-host-check", "--proxy-config", "proxy.conf.json"]

# 拘勇 FIN BLOQUE TEMPORAL

# ================================
# 游대 PARA VOLVER A PRODUCCI칍N:
# Simplemente elimina el bloque entre "拘勇" y "拘勇", y descomenta las l칤neas siguientes:
#
# Compilar el proyecto Angular en modo producci칩n
#RUN npm run build -- --configuration production
#
# Etapa 2: Imagen ligera con Nginx para servir la app
#FROM nginx:alpine
#
# Crear directorios necesarios y dar permisos a nginx (para evitar problemas de permisos)
#RUN mkdir -p /var/cache/nginx/client_temp \
#&& chown -R nginx:nginx /var/cache/nginx \
#&& mkdir -p /run \
#&& chown -R nginx:nginx /run

# Elimina archivos de configuraci칩n innecesarios de nginx si quieres ultra-optimizar
#RUN rm /etc/nginx/conf.d/default.conf
#
# Copiar el build de Angular a Nginx
#COPY --from=build /app/dist/frontend-app/browser/ /usr/share/nginx/html
#
# Copiar la configuraci칩n personalizada de Nginx
#COPY nginx.conf /etc/nginx/conf.d/default.conf
#
#  Exponer el puerto 80
#EXPOSE 80
#
# # Mejorar seguridad: correr Nginx como usuario no root
#USER nginx
#
# Comando para correr Nginx
#CMD ["nginx", "-g", "daemon off;"]
# ================================
